<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso8859-1">
<meta name="Author" content="Takafumi Shido">
<meta name="keywords" content="Sather, immutable class">
<meta name="description" content="On the immutable classes of Sather">
<meta http-equiv="CONTENT-SCRIPT-TYPE"  content="text/css;">
<meta name="robots" content="all">
<link rel="stylesheet" href="../shido_e.css" text="text/css">
<link rel="icon" href="../images/shido.png" type="image/png">
<title>(Try Sather) 10. Immutable classes</title>
</head>
<body>
<a name="top"></a>
<p class="header">
<table class='guide'><tr>
<td><a rel=home href='http://www.shido.info/index_e.php'>
  <img src='../images/shido_small.png' class='arrow' border=0>
HOME</a></td>

<td><a rel=prev href="sa_op_e.html"><img src='../images/left_arrow.gif' class='arrow' border=0>
  9. Operators</a></td>

<td><a rel=up href="index_e.html"><img src='../images/up_arrow.gif' class='arrow' border=0>
 Try Sather</a></td>

<td><a rel=next href="sa_hofunc_e.html">
  <img src='../images/right_arrow.gif' class='arrow' border=0>
11. Procedures as data</a></td>

<td><a href='../gb/write_guestbook_e.php?ref=sather/sa_immutable_e.html&t=%28Try+Sather%29+10%2E+Immutable+classes'>
<img src='../images/pencil.gif' class='arrow' border=0>Post Messages</a></td>
</tr></table></p>

<h1> 10. Immutable classes</h1>
<hr>

<h2>1. Introduction</h2>
Classes whose instances are immutable is called immutable class.
In the pre-defined classes, <tt>BOOL</tt>, <tt>CHAR</tt>, <tt>INT</tt>, <tt>FLT</tt>, etc. are immutable.

<h2>2. Simple example of immutable classes</h2>
Let's define  <tt>POINT</tt>, a class of two dimensional coordination, as an immutable class (code 1).
The way of assigning the attributes is somehow different
from that of conventional classes, as the instances are immutable.

<p>
<a name="point">
[code 1]
<pre class='code'>
<span class="linenumber">01:</span>     <span class="comment">-- a simple immutable class</span>
<span class="linenumber">02:</span>     
<span class="linenumber">03:</span>     immutable class POINT &lt; $STR is   <span class="comment">-- declare immutable </span>
<span class="linenumber">04:</span>        readonly attr x,y:FLT;         <span class="comment">-- declare read only attributes</span>
<span class="linenumber">05:</span>     
<span class="linenumber">06:</span>        create(x0,y0:FLT):SAME is      <span class="comment">-- the initiation is different from that of conventional ones.</span>
<span class="linenumber">07:</span>           res:SAME;                   <span class="comment">-- memory allocation by 'new' is not required</span>
<span class="linenumber">08:</span>           res:=res.x(x0);             <span class="comment">-- this is the way of assigning the attributes </span>
<span class="linenumber">09:</span>           res:=res.y(y0);
<span class="linenumber">10:</span>           return res;
<span class="linenumber">11:</span>        end;
<span class="linenumber">12:</span>     
<span class="linenumber">13:</span>        is_eq(p:SAME):BOOL is          <span class="comment">-- defining operator '=' </span>
<span class="linenumber">14:</span>           return x=p.x and y=p.y;
<span class="linenumber">15:</span>        end;
<span class="linenumber">16:</span>     
<span class="linenumber">17:</span>        plus(p:SAME):SAME is           <span class="comment">-- defining '+' </span>
<span class="linenumber">18:</span>           return #SAME(x+p.x, y+p.y);
<span class="linenumber">19:</span>        end;
<span class="linenumber">20:</span>     
<span class="linenumber">21:</span>        minus(p:SAME):SAME is          <span class="comment">--  operator '-' </span>
<span class="linenumber">22:</span>           return #SAME(x-p.x, y-p.y);
<span class="linenumber">23:</span>        end;
<span class="linenumber">24:</span>     
<span class="linenumber">25:</span>        times(n:FLT):SAME is           <span class="comment">-- operator '*' </span>
<span class="linenumber">26:</span>           return #SAME(x*n, y*n);
<span class="linenumber">27:</span>        end;
<span class="linenumber">28:</span>     
<span class="linenumber">29:</span>        div(n:FLT):SAME is             <span class="comment">-- operator '/' </span>
<span class="linenumber">30:</span>           return #SAME(x/n, y/n);
<span class="linenumber">31:</span>        end;
<span class="linenumber">32:</span>     
<span class="linenumber">33:</span>        negate:SAME is                 <span class="comment">-- unary operator '-' </span>
<span class="linenumber">34:</span>           return #SAME(-x, -y);
<span class="linenumber">35:</span>        end;
<span class="linenumber">36:</span>     
<span class="linenumber">37:</span>        abs:FLT is
<span class="linenumber">38:</span>           return (x*x+y*y).sqrt;
<span class="linenumber">39:</span>        end;
<span class="linenumber">40:</span>     
<span class="linenumber">41:</span>        rotate(theta:FLT):SAME is       <span class="comment">-- rotation</span>
<span class="linenumber">42:</span>           theta := y.atan2(x)+theta;
<span class="linenumber">43:</span>           return #SAME(self.abs*theta.cos, self.abs*theta.sin);
<span class="linenumber">44:</span>        end;
<span class="linenumber">45:</span>     
<span class="linenumber">46:</span>        str:STR is                      <span class="comment">-- convert to string</span>
<span class="linenumber">47:</span>           return "(" + x.str +"," + y.str +")";
<span class="linenumber">48:</span>        end;
<span class="linenumber">49:</span>     end;
<span class="linenumber">50:</span>     
<span class="linenumber">51:</span>     class MAIN is
<span class="linenumber">52:</span>        const pi:FLT:= FLT::pi;         <span class="comment">-- circle ratio</span>
<span class="linenumber">53:</span>        const fout:STR:="point.out";    <span class="comment">-- output file name</span>
<span class="linenumber">54:</span>     
<span class="linenumber">55:</span>        rz_polygon(a:ARRAY{POINT}, zoom, theta:FLT):ARRAY{POINT} is  <span class="comment">-- zoom and rotate a polygon</span>
<span class="linenumber">56:</span>           a1:ARRAY{POINT}:=#(a.size);
<span class="linenumber">57:</span>           loop
<span class="linenumber">58:</span>     	 a1.set!(a.elt!.rotate(theta).times(zoom));
<span class="linenumber">59:</span>           end;
<span class="linenumber">60:</span>           return a1;
<span class="linenumber">61:</span>        end;
<span class="linenumber">62:</span>     
<span class="linenumber">63:</span>        out2file(a0,a1:ARRAY{POINT}) is           <span class="comment">-- output two polygons, one before and one after the operation rz_polygon to the file</span>
<span class="linenumber">64:</span>           f:FILE:=FILE::open_for_write(fout);
<span class="linenumber">65:</span>           p0,p1:POINT;
<span class="linenumber">66:</span>           i:INT;
<span class="linenumber">67:</span>           loop
<span class="linenumber">68:</span>     	 i:=(a0.size+1).times!;
<span class="linenumber">69:</span>     	 if i = a0.size then i:=0; end;
<span class="linenumber">70:</span>     	 p0:=a0[i];
<span class="linenumber">71:</span>     	 p1:=a1[i];
<span class="linenumber">72:</span>     	 f + p0.x + "\t" + p0.y + "\t" + p1.x + "\t" + p1.y + "\n";
<span class="linenumber">73:</span>           end;
<span class="linenumber">74:</span>           f.close;
<span class="linenumber">75:</span>        end;
<span class="linenumber">76:</span>     
<span class="linenumber">77:</span>        main is
<span class="linenumber">78:</span>           p0:POINT:=#(0.0,1.0);
<span class="linenumber">79:</span>           a0:ARRAY{POINT}:=#(3);
<span class="linenumber">80:</span>     
<span class="linenumber">81:</span>           loop                            <span class="comment">-- making a equilateral triangle by rotation of (0.0, 1.0) by 0, 120, and 240 degrees</span>
<span class="linenumber">82:</span>     	 a0.set!(p0.rotate(3.times!.flt*2.0*pi/3.0));
<span class="linenumber">83:</span>           end;
<span class="linenumber">84:</span>           
<span class="linenumber">85:</span>           out2file(a0, rz_polygon(a0, 2.0, pi/12.0));  <span class="comment">-- output the original triangle and zoomed and rotated one (x 2, 15 degree)</span>
<span class="linenumber">86:</span>           
<span class="linenumber">87:</span>        end;
<span class="linenumber">88:</span>     end;
</pre>

Figure 1 shows the result plotted by the gnuplot.
<center>
<img src='point.png'><br>
Fig. 1: Original triangle (red) and one after zooming (x 2) and rotation (15 degree) (blue).
</center>
<h2>3. Summary</h2>
Instances of immutable classes are operated faster than those of conventional ones.
As a result, a class that makes many instances should be defined as a immutable class from the aspect of efficiency. 
<hr>
<p class="header">
<table class='guide'><tr>
<td><a rel=home href='http://www.shido.info/index_e.php'>
  <img src='../images/shido_small.png' class='arrow' border=0>
HOME</a></td>

<td><a rel=prev href="sa_op_e.html"><img src='../images/left_arrow.gif' class='arrow' border=0>
  9. Operators</a></td>

<td><a rel=up href="index_e.html"><img src='../images/up_arrow.gif' class='arrow' border=0>
 Try Sather</a></td>

<td><a rel=next href="sa_hofunc_e.html">
  <img src='../images/right_arrow.gif' class='arrow' border=0>
11. Procedures as data</a></td>


<td><a href='../gb/write_guestbook_e.php?ref=sather/sa_immutable_e.html&t=%28Try+Sather%29+10%2E+Immutable+classes'>
<img src='../images/pencil.gif' class='arrow' border=0>Post Messages</a></td>
</tr></table></p>

</body></html>
    




